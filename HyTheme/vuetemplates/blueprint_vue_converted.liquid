{% style src: "~/HyTheme/blueprint3d/css/bootstrap.css" ,  at:"Head"  %}
{% style src: "~/HyTheme/blueprint3d/css/example.css" ,  at:"Head"  %}
{% script src: "~/HyTheme/blueprint3d/js/three.min.js",  at:"Foot"  %}
{% script src: "~/HyTheme/blueprint3d/js/blueprint3d.js" , at:"Foot"  %}
{% script src: "~/HyTheme/blueprint3d/js/jquery.js" , at:"Foot"  %}
{% script src: "~/HyTheme/blueprint3d/js/bootstrap.js",  at:"Foot"  %}
{% script src: "~/HyTheme/blueprint3d/js/items.js", at:"Foot"  %}
{% script src: "~/HyTheme/blueprint3d/js/example.js",  at:"Foot"  %}

<div id="blueprint">
    <script>
    {% raw %}
    vueapp.component("BlueprintComponent", {
        props: ['displayText'],
        data: () => ({
            activeTab: 'floorplan',
            showContextMenu: false,
            contextMenuName: '',
            itemWidth: 0,
            itemDepth: 0,
            itemHeight: 0,
            itemLocked: false,
            wallTextures: [
                { name: 'marbletiles', thumbnail: '/HyTheme/blueprint3d/rooms/thumbnails/thumbnail_marbletiles.jpg' },
                { name: 'wallmap yellow', thumbnail: '/HyTheme/blueprint3d/rooms/thumbnails/thumbnail_wallmap_yellow.png' },
                { name: 'light brick', thumbnail: '/HyTheme/blueprint3d/rooms/thumbnails/thumbnail_light_brick.jpg' }
            ],
            loading: false
        }),
        methods: {
            setTab(tab) { this.activeTab = tab; },
            deleteItem() {
                // Delete selected item logic (from items.js)
            },
            selectFloorTexture(texture) {
                // Select floor texture logic (from blueprint3d.js)
            },
            selectWallTexture(texture) {
                // Select wall texture logic (from blueprint3d.js)
            },
                    setTab(tab) {
                        // Tab switching logic (SideMenu)
                        this.currentTab = tab;
                        // You may want to show/hide divs or update state as in SideMenu
                    },
                    deleteItem() {
                        // ContextMenu delete logic
                        if (this.selectedItem) {
                            this.selectedItem.remove();
                            this.selectedItem = null;
                        }
                    },
                    selectFloorTexture(texture) {
                        // TextureSelector for floor
                        if (this.currentTarget) {
                            this.currentTarget.setTexture(texture.url, texture.stretch, texture.scale);
                        }
                    },
                    selectWallTexture(texture) {
                        // TextureSelector for wall
                        if (this.currentTarget) {
                            this.currentTarget.setTexture(texture.url, texture.stretch, texture.scale);
                        }
                    },
                    newPlan() {
                        // mainControls newDesign logic
                        if (this.blueprint3d && this.blueprint3d.model) {
                            this.blueprint3d.model.loadSerialized('{"floorplan":{},"items":[]}');
                        }
                    },
                    savePlan() {
                        // mainControls saveDesign logic
                        if (this.blueprint3d && this.blueprint3d.model) {
                            const data = this.blueprint3d.model.exportSerialized();
                            const a = document.createElement('a');
                            const blob = new Blob([data], {type : 'text'});
                            a.href = window.URL.createObjectURL(blob);
                            a.download = 'design.blueprint3d';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        }
                    },
                    loadPlan(event) {
                        // mainControls loadDesign logic
                        const files = event.target.files;
                        if (files && files[0]) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                if (this.blueprint3d && this.blueprint3d.model) {
                                    this.blueprint3d.model.loadSerialized(e.target.result);
                                }
                            };
                            reader.readAsText(files[0]);
                        }
                    },
                    zoomIn(e) {
                        // CameraButtons zoomIn logic
                        if (this.orbitControls) {
                            this.orbitControls.dollyIn(1.1);
                            this.orbitControls.update();
                        }
                        if (e) e.preventDefault();
                    },
                    zoomOut(e) {
                        // CameraButtons zoomOut logic
                        if (this.orbitControls) {
                            this.orbitControls.dollyOut(1.1);
                            this.orbitControls.update();
                        }
                        if (e) e.preventDefault();
                    },
                    moveLeft() {
                        // CameraButtons pan left
                        if (this.orbitControls) {
                            this.orbitControls.panXY(30, 0);
                        }
                    },
                    moveRight() {
                        // CameraButtons pan right
                        if (this.orbitControls) {
                            this.orbitControls.panXY(-30, 0);
                        }
                    },
                    moveUp() {
                        // CameraButtons pan up
                        if (this.orbitControls) {
                            this.orbitControls.panXY(0, 30);
                        }
                    },
                    moveDown() {
                        // CameraButtons pan down
                        if (this.orbitControls) {
                            this.orbitControls.panXY(0, -30);
                        }
                    },
                    resizeItem(dimensions) {
                        // ContextMenu resize logic
                        if (this.selectedItem) {
                            this.selectedItem.resize(dimensions.height, dimensions.width, dimensions.depth);
                        }
                    },
                    fixItem(checked) {
                        // ContextMenu fix/unfix logic
                        if (this.selectedItem) {
                            this.selectedItem.setFixed(checked);
                        }
                    },
                    selectItem(item) {
                        // ContextMenu itemSelected logic
                        this.selectedItem = item;
                    },
                    unselectItem() {
                        // ContextMenu itemUnselected logic
                        this.selectedItem = null;
                    }
                            <a href='#'>Edit Floorplan <span class='glyphicon glyphicon-chevron-right pull-right'></span></a>
                        </li>
                        <li :class="{active: activeTab === 'design'}" @click="setTab('design')">
                            <a href='#'>Design <span class='glyphicon glyphicon-chevron-right pull-right'></span></a>
                        </li>
                        <li :class="{active: activeTab === 'items'}" @click="setTab('items')">
                            <a href='#'>Add Items <span class='glyphicon glyphicon-chevron-right pull-right'></span></a>
                        </li>
                    </ul>
                    <hr />
                    <div id='context-menu' v-if='showContextMenu'>
                        <div style='margin: 0 20px'>
                            <span id='context-menu-name' class='lead'>{{ contextMenuName }}</span>
                            <br /><br />
                            <button class='btn btn-block btn-danger' @click='deleteItem'>
                                <span class='glyphicon glyphicon-trash'></span> Delete Item
                            </button>
                            <br />
                            <div class='panel panel-default'>
                                <div class='panel-heading'>Adjust Size</div>
                                <div class='panel-body' style='color: #333333'>
                                    <div class='form form-horizontal lead'>
                                        <div class='form-group'>
                                            <label class='col-sm-5 control-label'>Width</label>
                                            <div class='col-sm-6'>
                                                <input type='number' class='form-control' v-model='itemWidth'>
                                            </div>
                                        </div>
                                        <div class='form-group'>
                                            <label class='col-sm-5 control-label'>Depth</label>
                                            <div class='col-sm-6'>
                                                <input type='number' class='form-control' v-model='itemDepth'>
                                            </div>
                                        </div>
                                        <div class='form-group'>
                                            <label class='col-sm-5 control-label'>Height</label>
                                            <div class='col-sm-6'>
                                                <input type='number' class='form-control' v-model='itemHeight'>
                                            </div>
                                        </div>
                                    </div>
                                    <small><span class='text-muted'>Measurements in inches.</span></small>
                                </div>
                            </div>
                            <label><input type='checkbox' v-model='itemLocked' /> Lock in place</label>
                            <br /><br />
                        </div>
                    </div>
                    <div id='floorTexturesDiv' v-if='activeTab === "design"' style='padding: 0 20px'>
                        <div class='panel panel-default'>
                            <div class='panel-heading'>Adjust Floor</div>
                            <div class='panel-body' style='color: #333333'>
                                <div class='col-sm-6' style='padding: 3px'>
                                    <a href='#' class='thumbnail texture-select-thumbnail' @click.prevent='selectFloorTexture("light_fine_wood")'>
                                        <img alt='Thumbnail light fine wood' src='/HyTheme/blueprint3d/rooms/thumbnails/thumbnail_light_fine_wood.jpg' />
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id='wallTextures' v-if='activeTab === "design"' style='padding: 0 20px'>
                        <div class='panel panel-default'>
                            <div class='panel-heading'>Adjust Wall</div>
                            <div class='panel-body' style='color: #333333'>
                                <div class='col-sm-6' style='padding: 3px' v-for='texture in wallTextures' :key='texture.name'>
                                    <a href='#' class='thumbnail texture-select-thumbnail' @click.prevent='selectWallTexture(texture)'>
                                        <img :alt='texture.name' :src='texture.thumbnail' />
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='col-xs-9 main'>
                    <div id='viewer'>
                        <div id='main-controls'>
                            <a href='#' class='btn btn-default btn-sm' @click='newPlan'>New Plan</a>
                            <a href='#' class='btn btn-default btn-sm' @click='savePlan'>Save Plan</a>
                            <a class='btn btn-sm btn-default btn-file'>
                                <input type='file' class='hidden-input' @change='loadPlan'>
                                Load Plan
                            </a>
                        </div>
                        <div id='camera-controls'>
                            <a href='#' class='btn btn-default bottom' @click='zoomOut'><span class='glyphicon glyphicon-zoom-out'></span></a>
                            <a href='#' class='btn btn-default bottom' @click='resetView'><span class='glyphicon glyphicon-home'></span></a>
                            <a href='#' class='btn btn-default bottom' @click='zoomIn'><span class='glyphicon glyphicon-zoom-in'></span></a>
                            <span>&nbsp;</span>
                            <a class='btn btn-default bottom' href='#' @click='moveLeft'><span class='glyphicon glyphicon-arrow-left'></span></a>
                            <span class='btn-group-vertical'>
                                <a class='btn btn-default' href='#' @click='moveUp'><span class='glyphicon glyphicon-arrow-up'></span></a>
                                <a class='btn btn-default' href='#' @click='moveDown'><span class='glyphicon glyphicon-arrow-down'></span></a>
                            </span>
                            <a class='btn btn-default bottom' href='#' @click='moveRight'><span class='glyphicon glyphicon-arrow-right'></span></a>
                        </div>
                        <div id='loading-modal' v-if='loading'>
                            <h1>Loading...</h1>
                        </div>
                    </div>
                    <div id='floorplanner' v-if='activeTab === "floorplan"'>
                        <canvas id='floorplanner-canvas'></canvas>
                        <div id='floorplanner-controls'>
                            <button id='move' class='btn btn-sm btn-default' @click='moveWalls'><span class='glyphicon glyphicon-move'></span> Move Walls</button>
                            <button id='draw' class='btn btn-sm btn-default' @click='drawWalls'><span class='glyphicon glyphicon-pencil'></span> Draw Walls</button>
                            <button id='delete' class='btn btn-sm btn-default' @click='deleteWalls'><span class='glyphicon glyphicon-remove'></span> Delete Walls</button>
                            <span class='pull-right'>
                                <button class='btn btn-primary btn-sm' @click='updateFloorplan'>Done &raquo;</button>
                            </span>
                        </div>
                        <div id='draw-walls-hint'>Press the "Esc" key to stop drawing walls</div>
                    </div>
                    <div id='add-items' v-if='activeTab === "items"'>
                        <div class='row' id='items-wrapper'>
                            <!-- Items added here by items.js -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        `
    });
    {% endraw %}
    </script>
</div>
